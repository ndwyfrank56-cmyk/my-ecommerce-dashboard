{% extends 'base.html' %}

{% block title %}Dashboard{% endblock title %}

{% block content %}
<style>
  /* Modern Dashboard Grid Layout */
  .dashboard-layout {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 16px;
    padding: 0;
  }
  
  /* Top Row: 2 large charts */
  .performance-section {
    grid-column: span 6;
  }
  
  .sessions-device-section {
    grid-column: span 6;
  }
  
  .sessions-device-section .chart-card {
    background: linear-gradient(135deg, rgba(14, 165, 166, 0.03) 0%, var(--surface) 100%);
  }

  /* Middle Row: 4 metrics + table */
  .metrics-row {
    grid-column: span 7;
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
  }
  
  .device-table-section {
    grid-column: span 5;
  }
  
  /* Bottom Row: Daily Overview */
  .daily-overview-section {
    grid-column: span 12;
  }
  
  .daily-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 16px;
  }
  
  .stat-item {
    display: flex;
    align-items: center;
    gap: 16px;
  }
  
  .stat-circle {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
  }
  
  /* btn-export now uses global style from styles.css (transparent pill button) */
  
  /* Individual Metric Card Styles */
  .metric-card {
    background: var(--surface);
    border: none;
    border-radius: 10px;
    padding: 10px 12px;
    position: relative;
    overflow: hidden;
  }
  
  .metric-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
  }
  
  .metric-card.card-red::before { background: #ef4444; }
  .metric-card.card-orange::before { background: #f97316; }
  .metric-card.card-green::before { background: #10b981; }
  .metric-card.card-purple::before { background: #a855f7; }
  
  .metric-icon {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
    margin-bottom: 8px;
  }
  
  .metric-card.card-red .metric-icon { background: rgba(239, 68, 68, 0.15); }
  .metric-card.card-orange .metric-icon { background: rgba(249, 115, 22, 0.15); }
  .metric-card.card-green .metric-icon { background: rgba(16, 185, 129, 0.15); }
  .metric-card.card-purple .metric-icon { background: rgba(168, 85, 247, 0.15); }
  
  /* Pending Orders Alert Animation */
  @keyframes pendingPulse {
    0%, 100% {
      background: var(--surface);
      box-shadow: 0 0 0 0 rgba(249, 115, 22, 0);
    }
    50% {
      background: rgba(249, 115, 22, 0.08);
      box-shadow: 0 0 0 8px rgba(249, 115, 22, 0);
    }
  }
  
  .metric-card.pending-alert {
    animation: pendingPulse 2s ease-in-out infinite;
    border: 1px solid rgba(249, 115, 22, 0.3);
  }
  
  .metric-card.pending-alert .metric-title i {
    color: #f97316 !important;
    opacity: 1 !important;
  }
  
  .metric-value {
    font-size: 22px;
    font-weight: 700;
    color: var(--text-primary);
    margin: 4px 0 2px 0;
    line-height: 1;
  }
  
  .metric-title {
    font-size: 11px;
    color: var(--text-muted);
    margin-bottom: 2px;
  }
  
  .metric-change {
    font-size: 10px;
    margin-top: 2px;
  }
  
  .metric-change.positive { color: #10b981; }
  .metric-change.negative { color: #ef4444; }
  
  /* Second Row: 3 Charts */
  .chart-row-3 {
    grid-column: span 12;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }
  
  /* Third Row: 3 Charts */
  .bottom-row-3 {
    grid-column: span 12;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }
  
  /* Chart Cards */
  .chart-card {
    background: var(--surface);
    border: none;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  
  .chart-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 16px;
    color: var(--text-primary);
  }
  
  .chart-subtitle {
    font-size: 12px;
    color: var(--text-muted);
    margin-bottom: 10px;
  }
  
  .chart-container {
    position: relative;
    height: 200px;
  }
  
  .chart-container-tall {
    position: relative;
    height: 300px;
  }
  
  /* Device Table Styles */
  .device-table {
    margin-top: 16px;
  }
  
  .table-header {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    padding: 8px 0;
    font-size: 11px;
    color: var(--text-muted);
    font-weight: 600;
    border-bottom: 1px solid var(--border);
  }
  
  .table-row {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    padding: 12px 0;
    border-bottom: 1px solid var(--border);
    align-items: center;
  }
  
  .progress-bar {
    height: 8px;
    border-radius: 4px;
    background: var(--border);
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    border-radius: 4px;
  }
  
  /* Top Customers Styles */
  .customers-row {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 16px;
  }
  
  .customer-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: var(--surface);
    border: none;
    border-radius: 12px;
  }
  
  .customer-circle {
    width: 70px;
    height: 70px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    flex-shrink: 0;
  }
  
  .customer-info {
    flex: 1;
    min-width: 0;
  }
  
  .customer-name {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 4px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  
  .customer-stats {
    font-size: 11px;
    color: var(--text-muted);
  }
  
  .customer-amount {
    font-size: 18px;
    font-weight: 700;
    color: var(--text-primary);
    margin-top: 4px;
  }
  
  /* Hide mobile payment status on desktop, show desktop payment status */
  .payment-status-mobile {
    display: none;
  }
  
  .payment-status-card {
    display: block;
  }
  
  /* Hide insights-payment-row on desktop (Quick Insights is already in wrapper on desktop) */
  .insights-payment-row {
    display: none !important;
  }
  
  /* Enhanced Top 5 Products Card Styling - Match Payment Status */
  .sessions-device-section .chart-card {
    background: linear-gradient(135deg, rgba(14, 165, 166, 0.03) 0%, var(--surface) 100%) !important;
  }
  
  /* Desktop layout - Performance takes more space */
  .performance-section { 
    grid-column: span 7 !important; 
  }
  
  .sessions-device-section { 
    grid-column: span 5 !important; 
  }
  
  /* Responsive Design */
  @media (max-width: 1400px) {
    .performance-section { grid-column: span 6; }
    .sessions-device-section { grid-column: span 6; }
  }
  
  @media (max-width: 1200px) {
    .customers-row { 
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }
  }
  
  @media (max-width: 1024px) {
    .dashboard-layout {
      padding: 12px;
      gap: 14px;
    }
    
    /* Stack charts on top of each other */
    .performance-section {
      grid-column: span 12;
    }
    
    .sessions-device-section {
      grid-column: span 12;
    }
    
    .chart-container-tall {
      height: 280px;
    }
    
    /* Stack wrapper on tablets */
    .responsive-wrapper {
      grid-template-columns: 1fr !important;
      gap: 12px !important;
    }
    
    .metrics-row { 
      grid-column: span 1; 
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .chart-card {
      padding: 18px;
    }
    
    .customers-row {
      grid-template-columns: 1fr;
      gap: 12px;
    }
    
    /* Better spacing for selects */
    select {
      padding: 8px 12px !important;
      font-size: 12px !important;
    }
  }
  
  @media (max-width: 992px) {
    .dashboard-layout { 
      grid-template-columns: 1fr; 
      gap: 12px;
      padding: 12px;
    }
    
    .performance-section,
    .sessions-device-section { 
      grid-column: span 1;
    }
    
    .chart-container-tall {
      height: 250px;
    }
    
    /* Stack wrapper on smaller tablets */
    .responsive-wrapper {
      grid-template-columns: 1fr !important;
      gap: 12px !important;
    }
    
    .metrics-row { 
      grid-column: span 1; 
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .chart-card {
      padding: 16px;
    }
  }
  
  @media (max-width: 768px) {
    .dashboard-layout {
      padding: 10px;
      gap: 12px;
    }
    
    .chart-card {
      padding: 14px;
      border-radius: 10px;
    }
    
    .chart-title {
      font-size: 14px;
      margin-bottom: 12px;
    }
    
    .chart-container-tall {
      height: 240px;
    }
    
    /* Stack metrics in 2 columns */
    .metrics-row {
      grid-template-columns: repeat(2, 1fr) !important;
      gap: 10px !important;
    }
    
    /* Better select styling */
    select {
      padding: 6px 10px !important;
      font-size: 11px !important;
    }
    
    /* Improve filter row wrapping */
    .chart-card > div[style*="display: flex"] {
      flex-wrap: wrap !important;
      gap: 8px !important;
    }
  }
  
  @media (max-width: 640px) {
    .dashboard-layout {
      padding: 8px;
      gap: 10px;
    }
    
    /* All main chart cards take full width */
    .performance-section,
    .sessions-device-section {
      grid-column: span 12 !important;
    }
    
    /* Wrapper takes full width and becomes vertical */
    .responsive-wrapper {
      grid-template-columns: 1fr !important;
      gap: 10px !important;
    }
    
    /* Hide desktop payment status on mobile */
    .payment-status-card {
      display: none !important;
    }
    
    /* Hide desktop Quick Insights on mobile, stack desktop charts row */
    .quick-insights-desktop {
      display: none !important;
    }
    
    .desktop-charts-row {
      grid-template-columns: 1fr !important;
      gap: 10px !important;
    }
    
    /* Stack metrics 2 per row */
    .metrics-row { 
      grid-template-columns: 1fr 1fr !important;
      gap: 8px !important;
    }
    
    .metric-card {
      padding: 10px !important;
    }
    
    /* Reduce chart heights on mobile - IMPORTANT! */
    .chart-container-tall {
      height: 200px !important;
    }
    
    /* Force Daily Orders chart height */
    .left-content .chart-card > div[style*="height: 200px"],
    .responsive-wrapper .chart-card > div[style*="height: 200px"] {
      height: 180px !important;
    }
    
    /* Ensure canvas containers don't stretch */
    .chart-card canvas {
      max-height: 180px !important;
    }
    
    /* Show insights-payment-row on mobile */
    .insights-payment-row {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 8px !important;
      grid-column: span 12 !important;
    }
    
    /* Show mobile payment status */
    .payment-status-mobile {
      display: block !important;
    }
    
    /* Compact Payment Status on mobile */
    #paymentStatusTableRows,
    #paymentStatusTableRowsMobile {
      gap: 8px !important;
    }
    
    /* Reduce card padding on mobile */
    .insights-payment-row .chart-card {
      padding: 10px !important;
    }
    
    /* Single column layout for Quick Insights on mobile for readability */
    .insights-payment-row .quick-insights-card > div:not(.chart-title) {
      display: flex !important;
      flex-direction: column !important;
      gap: 12px !important;
    }
    /* Make Quick Insights cells consistent and compact on mobile */
    .quick-insights-card > div:not(.chart-title) {
      display: flex !important;
      flex-direction: column !important;
      gap: 12px !important;
    }  
    .quick-insights-card > div:not(.chart-title) > div {
      padding: 10px !important;
      border-radius: 10px !important;
      min-height: 100px !important;
      display: flex !important;
      flex-direction: column !important;
      justify-content: space-between !important;
      gap: 6px !important;
      overflow: hidden !important;
    }
    .quick-insights-card .chart-title { 
      font-size: 12px !important; 
      margin-bottom: 8px !important; 
    }
    /* Readable text on mobile */
    .quick-insights-card > div:not(.chart-title) > div * {
      font-size: 12px !important;
      line-height: 1.25 !important;
      white-space: normal !important;
      overflow: visible !important;
      text-overflow: clip !important;
    }
    /* Emphasize main numbers */
    .quick-insights-card [style*="font-weight: 800"] {
      font-size: 18px !important;
    }
    /* Labels slightly larger */
    .quick-insights-card [style*="font-weight: 600"] {
      font-size: 12px !important;
    }
    
    /* Ensure individual insight items don't break the grid */
    .quick-insights-card > div:not(.chart-title) > div {
      min-width: 0 !important;
    }
    
    .customer-card { 
      flex-direction: row;
      padding: 12px;
    }
    
    .customer-circle {
      width: 60px;
      height: 60px;
    }
    
    .customer-circle > div {
      width: 46px !important;
      height: 46px !important;
    }
    
    .chart-container-tall {
      height: 220px;
    }
    
    /* Make pie chart legend stack below */
    #topProductsChart {
      max-height: 220px;
    }
    
    .chart-card {
      padding: 12px;
    }
    
    .chart-title {
      font-size: 13px;
    }
    
    /* Compact period pickers */
    select {
      max-width: 150px !important;
      font-size: 11px !important;
    }
  }
  
  @media (max-width: 480px) {
    .dashboard-layout {
      padding: 8px;
      gap: 10px;
    }
    
    /* All main sections take full width */
    .performance-section,
    .sessions-device-section,
    .daily-overview-section {
      grid-column: span 12 !important;
    }
    
    /* Wrapper takes full width and becomes vertical */
    .responsive-wrapper {
      grid-template-columns: 1fr !important;
      gap: 10px !important;
    }
    
    /* Hide desktop payment status on mobile */
    .payment-status-card {
      display: none !important;
    }
    
    /* Hide desktop Quick Insights on mobile, stack desktop charts row */
    .quick-insights-desktop {
      display: none !important;
    }
    
    .desktop-charts-row {
      grid-template-columns: 1fr !important;
      gap: 10px !important;
    }
    
    .chart-card {
      padding: 12px;
      border-radius: 10px;
    }
    
    /* Stack metrics 2 per row */
    .metrics-row {
      grid-template-columns: 1fr 1fr !important;
      gap: 8px !important;
    }
    
    .metric-card {
      padding: 10px !important;
    }
    
    .metric-value {
      font-size: 18px !important;
      margin: 4px 0 !important;
    }
    
    .metric-title {
      font-size: 10px !important;
    }
    
    /* Reduce chart heights significantly on small mobile */
    .chart-container-tall {
      height: 180px !important;
    }
    
    /* Force Daily Orders and other chart heights */
    .left-content .chart-card > div[style*="height: 200px"],
    .responsive-wrapper .chart-card > div[style*="height: 200px"] {
      height: 160px !important;
    }
    
    /* Ensure canvas containers don't stretch */
    .chart-card canvas {
      max-height: 160px !important;
    }
    
    /* Show insights-payment-row on mobile */
    .insights-payment-row {
      display: grid !important;
      grid-template-columns: 1fr 1fr !important;
      gap: 8px !important;
      grid-column: span 12 !important;
    }
    
    /* Show mobile payment status */
    .payment-status-mobile {
      display: block !important;
    }
    
    /* Compact Payment Status on mobile */
    #paymentStatusTableRows,
    #paymentStatusTableRowsMobile {
      gap: 6px !important;
    }
    
    /* Reduce card padding */
    .insights-payment-row .chart-card {
      padding: 10px !important;
    }
    
    /* Single column layout for Quick Insights on small mobile for readability */
    .insights-payment-row .quick-insights-card > div:not(.chart-title) {
      display: flex !important;
      flex-direction: column !important;
      gap: 10px !important;
    }
    /* Make Quick Insights cells consistent and compact on small mobile */
    .quick-insights-card > div:not(.chart-title) {
      display: flex !important;
      flex-direction: column !important;
      gap: 10px !important;
    }  
    .quick-insights-card > div:not(.chart-title) > div {
      padding: 8px !important;
      border-radius: 10px !important;
      min-height: 92px !important;
      display: flex !important;
      flex-direction: column !important;
      justify-content: space-between !important;
      gap: 4px !important;
      overflow: hidden !important;
    }
    .quick-insights-card .chart-title { 
      font-size: 12px !important; 
      margin-bottom: 8px !important; 
    }
    .quick-insights-card > div:not(.chart-title) > div * {
      font-size: 10px !important;
      line-height: 1.15 !important;
      white-space: nowrap !important;
      overflow: hidden !important;
      text-overflow: ellipsis !important;
    }
    
    /* Ensure individual insight items don't break the grid on small screens */
    .quick-insights-card > div:not(.chart-title) > div {
      min-width: 0 !important;
      overflow: hidden !important;
    }
    
    /* Make Quick Insights items more compact */
    .insights-payment-row .chart-card > div[style*="flex-direction: column"] {
      gap: 6px !important;
    }
    
    .insights-payment-row .chart-card > div[style*="flex-direction: column"] > div {
      padding: 6px !important;
    }
    
    /* Smaller fonts in Quick Insights and Payment Status */
    .insights-payment-row .chart-title {
      font-size: 12px !important;
      margin-bottom: 8px !important;
    }
    
    .insights-payment-row span[style*="font-size: 15px"] {
      font-size: 13px !important;
    }
    
    .insights-payment-row div[style*="font-size: 16px"] {
      font-size: 14px !important;
    }
    
    .chart-title {
      font-size: 13px;
      margin-bottom: 10px;
    }
    
    .customer-name {
      font-size: 13px;
    }
    
    .customer-amount {
      font-size: 16px;
    }
    
    select {
      font-size: 10px !important;
      padding: 5px 8px !important;
    }
    
    /* Better chart heights */
    .chart-container-tall {
      height: 180px !important;
    }
    
    /* Stack all filters vertically */
    .chart-card > div[style*="display: flex"] {
      flex-direction: column !important;
      align-items: flex-start !important;
      gap: 8px !important;
    }
    
    .chart-card > div[style*="display: flex"] > div {
      display: flex !important;
      gap: 8px !important;
      width: 100% !important;
    }
    
    /* Compact selects on mobile */
    select {
      flex: 1 !important;
      min-width: 0 !important;
      max-width: 150px !important;
      font-size: 11px !important;
      padding: 6px 8px !important;
    }
    
    /* Make chart headers wrap on tiny screens */
    .chart-card > div[style*="display: flex"] {
      flex-wrap: wrap !important;
      gap: 8px !important;
    }
    
    .chart-card > div[style*="display: flex"] > div:last-child {
      flex-wrap: wrap !important;
    }
  }
  
</style>

<div class="orders-page">
  <div class="orders-header d-flex align-items-center justify-content-between mb-4">
    <h1 class="h5 m-0"> Admin dashboard</h1>
    <div class="d-flex gap-3 align-items-center">
      <button class="btn-refresh" onclick="location.reload()"><i class="fa-solid fa-rotate-right"></i> Refresh</button>
      <a href="{{ url_for('profile') }}" class="profile-avatar" style="text-decoration:none;">
        <div class="avatar-circle" style="width: 28px; height: 28px;">
          <i class="fa-solid fa-user" style="font-size: 12px;"></i>
        </div>
      </a>
    </div>
  </div>

  <!-- MODERN DASHBOARD GRID LAYOUT -->
  <div class="dashboard-layout">
    
    <!-- TOP ROW: PERFORMANCE CHART -->
    <div class="performance-section">
      <div class="chart-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
          <div>
            <div class="chart-title" style="margin: 0;">Business Month Performance</div>
            <div id="performanceMonthLabel" style="font-size: 11px; color: var(--text-muted); margin-top: 2px;"></div>
          </div>
          <div style="display: flex; gap: 8px;">
            <select id="performanceMonth" style="padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-primary); font-size: 12px; cursor: pointer;">
              <option value="1">January</option>
              <option value="2">February</option>
              <option value="3">March</option>
              <option value="4">April</option>
              <option value="5">May</option>
              <option value="6">June</option>
              <option value="7">July</option>
              <option value="8">August</option>
              <option value="9">September</option>
              <option value="10" selected>October</option>
              <option value="11">November</option>
              <option value="12">December</option>
            </select>
            <select id="performanceYear" style="padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-primary); font-size: 12px; cursor: pointer;">
              <option value="2023">2023</option>
              <option value="2024">2024</option>
              <option value="2025" selected>2025</option>
              <option value="2026">2026</option>
            </select>
          </div>
        </div>
        <div class="chart-container-tall">
          <canvas id="performanceChart"></canvas>
        </div>
      </div>
    </div>
    
    <!-- TOP ROW: TOP 5 PRODUCTS REVENUE TABLE -->
    <div class="sessions-device-section">
      <div class="chart-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <div class="chart-title" style="margin: 0;">Top 5 Products by Revenue</div>
          <select id="topProductsPeriod" style="padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-primary); font-size: 12px; cursor: pointer;">
            <option value="today">Today</option>
            <option value="7days">Last 7 Days</option>
            <option value="month" selected>This Month</option>
            <option value="all">All Time</option>
          </select>
        </div>
        
        <!-- Revenue Table -->
        <div style="height: 300px; overflow-y: auto; overflow-x: auto;">
          <table id="topProductsTable" style="width: 100%; border-collapse: collapse;">
            <thead style="position: sticky; top: 0; background: var(--surface); z-index: 1;">
              <tr style="border-bottom: 2px solid rgba(255, 255, 255, 0.1);">
                <th style="text-align: left; padding: 12px 8px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase;">Product</th>
                <th style="text-align: right; padding: 12px 8px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase;">Units</th>
                <th style="text-align: right; padding: 12px 8px; font-size: 11px; font-weight: 600; color: var(--text-muted); text-transform: uppercase;">Revenue</th>
              </tr>
            </thead>
            <tbody id="topProductsTableBody">
              <!-- Will be populated by JavaScript -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- WRAPPER: METRIC CARDS + GRAPH ROW + PAYMENT STATUS ON RIGHT -->
    <div class="responsive-wrapper" style="grid-column: span 12; display: grid; grid-template-columns: 1fr 280px; gap: 16px;">
      
      <!-- LEFT SIDE: METRIC CARDS + GRAPHS -->
      <div class="left-content" style="display: flex; flex-direction: column; gap: 16px;">
        
        <!-- 4 METRIC CARDS -->
        <div class="metrics-row">
          <!-- Monthly Revenue -->
          <div class="metric-card" style="padding: 8px 12px;">
            <div class="metric-title" style="font-size: 10px; display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-coins" style="font-size: 11px; color: #0ea5a6; opacity: 0.7;"></i>
              Monthly Revenue
            </div>
            <div class="metric-value" style="font-size: 20px; margin: 2px 0;">RWF {{ "{:,.0f}".format(monthly_revenue) }}</div>
            <div class="metric-change {% if revenue_growth >= 0 %}positive{% else %}negative{% endif %}" style="font-size: 9px;">
              {{ "{:+.1f}".format(revenue_growth) }}%
            </div>
          </div>
          
          <!-- Total Orders This Month -->
          <div class="metric-card" style="padding: 8px 12px;">
            <div class="metric-title" style="font-size: 10px; display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-shopping-cart" style="font-size: 11px; color: #0ea5a6; opacity: 0.7;"></i>
              Orders This Month
            </div>
            <div class="metric-value" style="font-size: 20px; margin: 2px 0;">{{ monthly_orders }}</div>
            <div class="metric-change positive" style="font-size: 9px;">This Month</div>
          </div>
          
          <!-- Average Order Value -->
          <div class="metric-card" style="padding: 8px 12px;">
            <div class="metric-title" style="font-size: 10px; display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-chart-line" style="font-size: 11px; color: #0ea5a6; opacity: 0.7;"></i>
              Avg Order Value
            </div>
            <div class="metric-value" style="font-size: 20px; margin: 2px 0;">RWF {{ "{:,.0f}".format(average_order_value) }}</div>
            <div class="metric-change positive" style="font-size: 9px;">All Time</div>
          </div>
          
          <!-- Pending Orders -->
          <div class="metric-card {% if pending_orders_count > 0 %}pending-alert{% endif %}" style="padding: 8px 12px;">
            <div class="metric-title" style="font-size: 10px; display: flex; align-items: center; gap: 6px;">
              <i class="fas fa-clock" style="font-size: 11px; color: #0ea5a6; opacity: 0.7;"></i>
              Pending Orders
            </div>
            <div class="metric-value" style="font-size: 20px; margin: 2px 0;">{{ pending_orders_count }}</div>
            <div class="metric-change {% if pending_orders_count > 0 %}negative{% else %}positive{% endif %}" style="font-size: 9px;">
              {% if pending_orders_count > 0 %}Needs Attention{% else %}All Clear{% endif %}
            </div>
          </div>
        </div>
        
        <!-- DAILY ORDERS + QUICK INSIGHTS ROW (DESKTOP) -->
        <div class="desktop-charts-row" style="display: grid; grid-template-columns: 1.8fr 1fr; gap: 16px;">
          
          <!-- DAILY ORDERS BAR CHART -->
          <div class="chart-card" style="background: linear-gradient(135deg, rgba(14, 165, 166, 0.03) 0%, var(--surface) 100%);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div class="chart-title" style="margin: 0;">Daily Orders</div>
              <div style="display: flex; gap: 10px;">
                <select id="dailyOrdersMonth" style="padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-primary); font-size: 12px; cursor: pointer;">
                  <option value="1">January</option>
                  <option value="2">February</option>
                  <option value="3">March</option>
                  <option value="4">April</option>
                  <option value="5">May</option>
                  <option value="6">June</option>
                  <option value="7">July</option>
                  <option value="8">August</option>
                  <option value="9">September</option>
                  <option value="10" selected>October</option>
                  <option value="11">November</option>
                  <option value="12">December</option>
                </select>
                <select id="dailyOrdersYear" style="padding: 6px 10px; border-radius: 8px; border: 1px solid var(--border); background: var(--surface); color: var(--text-primary); font-size: 12px; cursor: pointer;">
                  <option value="2023">2023</option>
                  <option value="2024">2024</option>
                  <option value="2025" selected>2025</option>
                  <option value="2026">2026</option>
                </select>
              </div>
            </div>
            <div style="height: 200px;">
              <canvas id="dailyOrdersChart"></canvas>
            </div>
          </div>
          
          <!-- QUICK INSIGHTS (DESKTOP VERSION) -->
          <div class="chart-card quick-insights-desktop" style="padding: 14px; background: linear-gradient(135deg, rgba(14, 165, 166, 0.03) 0%, var(--surface) 100%);">
            <div class="chart-title" style="margin-bottom: 12px; font-size: 16px; font-weight: 700;">Quick Insights</div>
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <!-- Today's Sales -->
              <div style="padding: 8px; background: linear-gradient(135deg, rgba(5, 150, 105, 0.08), rgba(5, 150, 105, 0.03)); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                  <span style="font-size: 13px; color: #e5e7eb; font-weight: 700;">Today's Sales</span>
                  <span style="font-size: 18px; font-weight: 800; color: #10b981;">RWF {{ "{:,.0f}".format(today_revenue) }}</span>
                </div>
                <div style="font-size: 12px; color: #9ca3af; font-weight: 500;">{{ today_orders }} orders • RWF {{ "{:,.0f}".format(today_avg_order_value) }} avg</div>
              </div>

              <!-- Revenue Growth -->
              <div style="padding: 8px; background: linear-gradient(135deg, rgba(4, 120, 87, 0.08), rgba(4, 120, 87, 0.03)); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                  <span style="font-size: 13px; color: #e5e7eb; font-weight: 700;">Growth Rate</span>
                  <span style="font-size: 18px; font-weight: 800; color: {% if revenue_growth >= 0 %}#10b981{% else %}#ef4444{% endif %};">
                    {{ "{:+.1f}".format(revenue_growth) }}%
                  </span>
                </div>
                <div style="font-size: 12px; color: #9ca3af; font-weight: 500;">vs last month</div>
              </div>

              <!-- Stock Alert -->
              <div style="padding: 8px; background: linear-gradient(135deg, rgba(185, 28, 28, 0.12), rgba(185, 28, 28, 0.04)); border-radius: 8px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px;">
                  <span style="font-size: 13px; color: #e5e7eb; font-weight: 700;">Stock Alerts</span>
                  <span style="font-size: 18px; font-weight: 800; color: #ef4444;">{{ low_stock_count }}</span>
                </div>
                <div style="font-size: 12px; color: #9ca3af; font-weight: 500;">items need attention</div>
              </div>
            </div>
          </div>
        
        </div>
        
      </div>
      
      <!-- RIGHT SIDE: PAYMENT STATUS (TALL & THIN - SPANS BOTH ROWS) -->
      <div class="chart-card payment-status-card" style="padding: 16px; background: linear-gradient(135deg, rgba(14, 165, 166, 0.03) 0%, var(--surface) 100%);">
        <div style="margin-bottom: 16px;">
          <div class="chart-title" style="margin: 0; font-size: 14px;">Payment Status</div>
          <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">This Month</div>
        </div>
        <div id="paymentStatusTableRows" style="display: flex; flex-direction: column; gap: 16px;">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      
    </div>

    <!-- QUICK INSIGHTS + PAYMENT STATUS ROW (SIDE BY SIDE ON MOBILE) -->
    <div class="insights-payment-row" style="grid-column: span 12; display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
      
      <!-- QUICK INSIGHTS -->
      <div class="chart-card quick-insights-card" style="padding: 14px; background: linear-gradient(135deg, rgba(14, 165, 166, 0.03) 0%, var(--surface) 100%);">
        <div class="chart-title" style="margin-bottom: 12px; font-size: 16px; font-weight: 700;">Quick Insights</div>
        <div style="display: flex; flex-direction: column; gap: 12px;">
          <!-- Today's Sales -->
          <div style="padding: 14px; border: 1px solid var(--border); border-radius: 10px; background: rgba(5,150,105,0.06);">
            <div style="font-size: 15px; color: #e5e7eb; font-weight: 700; margin-bottom: 8px;">Today's Sales</div>
            <div style="display:flex; align-items: center; justify-content: space-between;">
              <div style="font-size: 22px; font-weight: 800; color:#10b981;">RWF {{ "{:,.0f}".format(today_revenue) }}</div>
            </div>
            <div style="font-size: 13px; color: #9ca3af; font-weight: 500; margin-top: 6px;">{{ today_orders }} orders • RWF {{ "{:,.0f}".format(today_avg_order_value) }} avg</div>
          </div>

          <!-- Growth -->
          <div style="padding: 14px; border: 1px solid var(--border); border-radius: 10px; background: rgba(4,120,87,0.05);">
            <div style="font-size: 15px; color: #e5e7eb; font-weight: 700; margin-bottom: 8px;">Growth Rate</div>
            <div style="display:flex; align-items: center; justify-content: space-between;">
              <div style="font-size: 22px; font-weight: 800; color:{% if revenue_growth >= 0 %}#10b981{% else %}#ef4444{% endif %};">{{ "{:+.1f}".format(revenue_growth) }}%</div>
            </div>
            <div style="font-size: 13px; color: #9ca3af; font-weight: 500; margin-top: 6px;">vs last month</div>
          </div>

          <!-- Out of Stock / Low Stock -->
          <div style="padding: 14px; border: 1px solid var(--border); border-radius: 10px; background: rgba(185,28,28,0.08);">
            <div style="font-size: 15px; color: #e5e7eb; font-weight: 700; margin-bottom: 8px;">Stock Alerts</div>
            <div style="display:flex; align-items: center; justify-content: space-between;">
              <div style="font-size: 22px; font-weight: 800; color:#ef4444;">{{ low_stock_count }}</div>
            </div>
            <div style="font-size: 13px; color: #9ca3af; font-weight: 500; margin-top: 6px;">items need attention</div>
          </div>
        </div>
      </div>

      <!-- PAYMENT STATUS (DUPLICATE FOR MOBILE) -->
      <div class="chart-card payment-status-mobile" style="padding: 16px; background: linear-gradient(135deg, rgba(14, 165, 166, 0.03) 0%, var(--surface) 100%);">
        <div style="margin-bottom: 16px;">
          <div class="chart-title" style="margin: 0; font-size: 14px;">Payment Status</div>
          <div style="font-size: 10px; color: var(--text-muted); margin-top: 2px;">This Month</div>
        </div>
        <div id="paymentStatusTableRowsMobile" style="display: flex; flex-direction: column; gap: 16px;">
          <!-- Will be populated by JavaScript -->
        </div>
      </div>
      
    </div>
    
  </div> <!-- End dashboard-layout -->
  
</div> <!-- End orders-page -->

<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<script>
// Chart defaults
Chart.defaults.color = '#9ca3af';
Chart.defaults.font.family = 'system-ui, -apple-system, sans-serif';

// 1. Performance Chart - Dynamic Revenue Chart with Month/Year Filter
let performanceChart = null;

// Set current month and year as default
const now = new Date();
const currentMonth = now.getMonth() + 1; // JavaScript months are 0-indexed
const currentYear = now.getFullYear();
document.getElementById('performanceMonth').value = currentMonth;
document.getElementById('performanceYear').value = currentYear;

async function loadPerformanceChart() {
  const month = document.getElementById('performanceMonth').value;
  const year = document.getElementById('performanceYear').value;
  
  try {
    const response = await fetch(`/api/revenue/daily?month=${month}&year=${year}`);
    const result = await response.json();
    
    if (!result.ok) {
      console.error('Failed to load revenue data:', result.error);
      return;
    }
    
    const data = result.data;
    
    // Update month label using selected month/year
    const monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    document.getElementById('performanceMonthLabel').textContent = monthNames[parseInt(month) - 1] + ' ' + year;
    
    // Handle empty data
    if (!data || data.length === 0) {
      // Destroy existing chart
      if (performanceChart) {
        performanceChart.destroy();
        performanceChart = null;
      }
      
      // Show "No data" message
      const canvas = document.getElementById('performanceChart');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#8b949e';
      ctx.font = '14px system-ui, -apple-system, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('No revenue data available for this period', canvas.width / 2, canvas.height / 2);
      return;
    }
    
    const labels = data.map(item => {
      const date = new Date(item.date);
      return date.getDate(); // Show only day number
    });
    const revenues = data.map(item => item.revenue);
    
    // Identify peak revenue point for clarity (bigger point + tooltip tag)
    const maxRevenue = revenues.length ? Math.max(...revenues) : 0;
    const peakIndex = revenues.indexOf(maxRevenue);
    const pointRadii = revenues.map((_, i) => (i === peakIndex ? 6 : 3));
    const pointBGs = revenues.map((_, i) => (i === peakIndex ? '#22d3ee' : '#0ea5a6'));
    const pointBorders = revenues.map((_, i) => (i === peakIndex ? '#ffffff' : '#ffffff'));
    const pointBorderWidths = revenues.map((_, i) => (i === peakIndex ? 2 : 1));
    
    // Destroy existing chart if it exists
    if (performanceChart) {
      performanceChart.destroy();
    }
    
    // Create new chart with teal color matching website theme
    performanceChart = new Chart(document.getElementById('performanceChart'), {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Daily Revenue (RWF)',
          data: revenues,
          borderColor: '#0ea5a6',
          backgroundColor: function(context) {
            const chart = context.chart;
            const {ctx, chartArea} = chart;
            if (!chartArea) return 'rgba(14, 165, 166, 0.1)';
            
            const gradient = ctx.createLinearGradient(0, chartArea.top, 0, chartArea.bottom);
            gradient.addColorStop(0, 'rgba(14, 165, 166, 0.3)');
            gradient.addColorStop(0.5, 'rgba(14, 165, 166, 0.1)');
            gradient.addColorStop(1, 'rgba(14, 165, 166, 0)');
            return gradient;
          },
          fill: true,
          tension: 0.5,
          borderWidth: 3,
          pointRadius: pointRadii,
          pointBackgroundColor: pointBGs,
          pointBorderColor: pointBorders,
          pointBorderWidth: pointBorderWidths,
          pointHoverRadius: 8,
          pointHoverBackgroundColor: '#0ea5a6',
          pointHoverBorderColor: '#fff',
          pointHoverBorderWidth: 3
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: { display: false },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleColor: '#fff',
            bodyColor: '#fff',
            callbacks: {
              label: function(context) {
                return 'Revenue: RWF ' + context.parsed.y.toLocaleString(undefined, {maximumFractionDigits: 0});
              },
              footer: function(items) {
                if (!items || !items.length) return '';
                const idx = items[0].dataIndex;
                if (idx === peakIndex) {
                  return 'Peak day: ' + labels[idx];
                }
                return '';
              }
            }
          }
        },
        scales: {
          y: { 
            beginAtZero: true, 
            grid: { 
              display: true,
              color: 'rgba(255, 255, 255, 0.03)',
              lineWidth: 1,
              drawBorder: false
            }, 
            ticks: { 
              color: '#9ca3af',
              callback: function(value) {
                if (value >= 1000000) {
                  return 'RWF ' + (value / 1000000).toFixed(1) + 'M';
                } else if (value >= 1000) {
                  return 'RWF ' + (value / 1000).toFixed(0) + 'k';
                }
                return 'RWF ' + value;
              }
            }
          },
          x: { 
            grid: { 
              display: true,
              color: 'rgba(255, 255, 255, 0.02)',
              lineWidth: 1,
              drawBorder: false
            }, 
            ticks: { 
              color: '#9ca3af',
              maxRotation: 45,
              autoSkip: true,
              maxTicksLimit: 15,
              font: { size: 9 },
              callback: function(value, index) {
                // Show every 2nd or 3rd label depending on data density
                const totalLabels = this.chart.data.labels.length;
                const skipRate = totalLabels > 20 ? 2 : 1;
                return index % skipRate === 0 ? this.chart.data.labels[index] : '';
              }
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error loading performance chart:', error);
  }
}

// Load chart on page load
loadPerformanceChart();

// Reload chart when filters change
document.getElementById('performanceMonth').addEventListener('change', loadPerformanceChart);
document.getElementById('performanceYear').addEventListener('change', loadPerformanceChart);

// 2. Payment Status - THIS MONTH (Redesigned)
async function loadPaymentStatusToday() {
  try {
    const response = await fetch(`/api/payment-status?period=month`);
    const result = await response.json();
    
    if (!result.ok) {
      console.error('Failed to load payment status:', result.error);
      return;
    }
    
    const paid = result.paid || 0;
    const pending = result.pending || 0;
    const cancelled = result.cancelled || 0;
    const total = result.total || 1;
    const paidRevenue = result.paid_revenue || 0;
    const pendingRevenue = result.pending_revenue || 0;
    const cancelledRevenue = result.cancelled_revenue || 0;
    
    const paidPercent = total > 0 ? ((paid / total) * 100) : 0;
    const pendingPercent = total > 0 ? ((pending / total) * 100) : 0;
    const cancelledPercent = total > 0 ? ((cancelled / total) * 100) : 0;
    
    // Create cleaner status cards with revenue (HTML content)
    const paymentStatusHTML = `
      <div style="display: flex; flex-direction: column; gap: 3px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 14px; font-weight: 700; color: #10b981;">Paid</span>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 18px; font-weight: 800; color: #ffffff;">${paid}</div>
          </div>
        </div>
        <div class="progress-bar" style="height: 6px;">
          <div class="progress-fill" style="width: ${paidPercent}%; background: #10b981;"></div>
        </div>
      </div>
      
      <div style="display: flex; flex-direction: column; gap: 3px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 14px; font-weight: 700; color: #f97316;">Pending</span>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 18px; font-weight: 800; color: #ffffff;">${pending}</div>
          </div>
        </div>
        <div class="progress-bar" style="height: 6px;">
          <div class="progress-fill" style="width: ${pendingPercent}%; background: #f97316;"></div>
        </div>
      </div>
      
      <div style="display: flex; flex-direction: column; gap: 3px;">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 14px; font-weight: 700; color: #ef4444;">Cancelled</span>
          </div>
          <div style="text-align: right;">
            <div style="font-size: 18px; font-weight: 800; color: #ffffff;">${cancelled}</div>
          </div>
        </div>
        <div class="progress-bar" style="height: 6px;">
          <div class="progress-fill" style="width: ${cancelledPercent}%; background: #ef4444;"></div>
        </div>
      </div>
    `;
    
    // Populate both desktop and mobile containers
    const tableContainer = document.getElementById('paymentStatusTableRows');
    const tableContainerMobile = document.getElementById('paymentStatusTableRowsMobile');
    tableContainer.innerHTML = paymentStatusHTML;
    tableContainerMobile.innerHTML = paymentStatusHTML;
  } catch (error) {
    console.error('Error loading payment status:', error);
  }
}

// Load payment status on page load
loadPaymentStatusToday();

// 3. Top 5 Products Revenue Table (Dynamic)
async function loadTopProductsTable() {
  const period = document.getElementById('topProductsPeriod').value;
  
  try {
    const response = await fetch(`/api/top-products?period=${period}`);
    const result = await response.json();
    
    if (!result.ok || !result.products || result.products.length === 0) {
      document.getElementById('topProductsTableBody').innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 24px; color: var(--text-muted);">No product data available</td></tr>';
      return;
    }
    
    const products = result.products;
    
    // Calculate total revenue
    const totalRevenue = products.reduce((sum, p) => sum + (p.revenue || 0), 0);
    
    // Build table rows
    let tableHTML = '';
    products.forEach((product, index) => {
      const revenue = product.revenue || 0;
      
      // Highlight row based on rank
      const bgColor = index === 0 ? 'rgba(14, 165, 166, 0.15)' : 'transparent';
      const borderBottom = index < products.length - 1 ? 'border-bottom: 1px solid rgba(255, 255, 255, 0.05);' : '';
      
      tableHTML += `
        <tr style="background: ${bgColor}; ${borderBottom}">
          <td style="padding: 14px 8px; font-size: 13px; font-weight: 600; color: var(--text-primary);">${product.name}</td>
          <td style="padding: 14px 8px; text-align: right; font-size: 13px; font-weight: 600; color: var(--text-primary);">${product.quantity}</td>
          <td style="padding: 14px 8px; text-align: right; font-size: 14px; font-weight: 700; color: #0ea5a6;">RWF ${revenue.toLocaleString(undefined, {maximumFractionDigits: 0})}</td>
        </tr>
      `;
    });
    
    document.getElementById('topProductsTableBody').innerHTML = tableHTML;
    
  } catch (error) {
    console.error('Error loading top products table:', error);
    document.getElementById('topProductsTableBody').innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 24px; color: #ef4444;">Error loading data</td></tr>';
  }
}

// Load top products table on page load
loadTopProductsTable();

// Reload table when filter changes
document.getElementById('topProductsPeriod').addEventListener('change', loadTopProductsTable);

// 4. Daily Orders Bar Chart
let dailyOrdersChartInstance = null;

// Set current month and year as default for Daily Orders
document.getElementById('dailyOrdersMonth').value = currentMonth;
document.getElementById('dailyOrdersYear').value = currentYear;

async function loadDailyOrdersChart() {
  const month = document.getElementById('dailyOrdersMonth').value;
  const year = document.getElementById('dailyOrdersYear').value;
  
  try {
    const response = await fetch(`/api/orders/daily?month=${month}&year=${year}`);
    const result = await response.json();
    
    if (!result.ok) {
      console.error('Failed to load daily orders:', result.error);
      return;
    }
    
    const days = result.days;
    const orders = result.orders;
    
    // Handle empty data
    if (!days || days.length === 0) {
      // Destroy existing chart
      if (dailyOrdersChartInstance) {
        dailyOrdersChartInstance.destroy();
        dailyOrdersChartInstance = null;
      }
      
      // Show "No data" message
      const canvas = document.getElementById('dailyOrdersChart');
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = '#8b949e';
      ctx.font = '14px system-ui, -apple-system, sans-serif';
      ctx.textAlign = 'center';
      ctx.fillText('No order data available for this period', canvas.width / 2, canvas.height / 2);
      return;
    }
    
    // Format labels - just show day numbers
    const formattedLabels = days;
    
    // Destroy existing chart if it exists
    if (dailyOrdersChartInstance) {
      dailyOrdersChartInstance.destroy();
    }
    
    // Create new bar chart
    dailyOrdersChartInstance = new Chart(document.getElementById('dailyOrdersChart'), {
      type: 'bar',
      data: {
        labels: formattedLabels,
        datasets: [{
          label: 'Orders',
          data: orders,
          backgroundColor: function(context) {
            const chart = context.chart;
            const {ctx, chartArea} = chart;
            if (!chartArea) return '#0ea5a6';
            
            const gradient = ctx.createLinearGradient(0, chartArea.bottom, 0, chartArea.top);
            gradient.addColorStop(0, '#0d7377');
            gradient.addColorStop(1, '#14b8a6');
            return gradient;
          },
          borderWidth: 0,
          borderRadius: 6,
          borderSkipped: false
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            titleColor: '#fff',
            bodyColor: '#fff',
            callbacks: {
              label: function(context) {
                return context.parsed.y + ' orders';
              }
            }
          }
        },
        scales: {
          x: {
            grid: {
              display: true,
              color: 'rgba(255, 255, 255, 0.02)',
              lineWidth: 1,
              drawBorder: false
            },
            ticks: {
              color: '#9ca3af',
              font: { size: 9 },
              maxRotation: 0,
              autoSkip: false,
              maxTicksLimit: 31,
              align: 'center'
            }
          },
          y: {
            beginAtZero: true,
            grid: {
              display: true,
              color: 'rgba(255, 255, 255, 0.03)',
              lineWidth: 1,
              drawBorder: false
            },
            ticks: {
              color: '#9ca3af',
              font: { size: 11 },
              stepSize: 1
            }
          }
        }
      }
    });
  } catch (error) {
    console.error('Error loading daily orders chart:', error);
  }
}

// Load daily orders chart on page load
loadDailyOrdersChart();

// Reload chart when filters change
document.getElementById('dailyOrdersMonth').addEventListener('change', loadDailyOrdersChart);
document.getElementById('dailyOrdersYear').addEventListener('change', loadDailyOrdersChart);

</script>
{% endblock %}
